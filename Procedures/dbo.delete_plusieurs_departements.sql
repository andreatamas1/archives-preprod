SET ANSI_NULLS ON
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- Author:		<Author,,Name>
-- Create date: <Create Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[delete_plusieurs_departements]
	-- Add the parameters for the stored procedure here
	-- Test Run : delete_plusieurs_departements '7DA68C98-741C-4CAD-ADAB-17F41AA36A37,BC9AAD7F-4211-4D1C-BE04-3D0ABC513DC0,174145D4-3139-4B03-80D6-4399ECFD3AAD,D4F010C2-22AB-4862-AEC5-55A0B55E2239,EC051990-F100-4555-9822-58067E0C9503,3FB0F8BB-8564-48F0-A240-61AB4ACC5789,641A1A47-56FB-4271-A3A9-6B7077487F87,D215EC50-334C-4130-B112-708E8599AA99,9B4D3492-106F-47A8-9218-8A83C5FB22A2,CB732C41-0794-479D-88DF-AFBB639131FD,D630DF1D-EB7B-4C65-A5C4-B172FFE56553,08738B3C-6AEB-4BC1-930B-B2BF74161008,889EB926-5EF5-4D51-8616-B95AE4BCA4BB,E225E6D9-460A-4883-921D-B9D43FD9DDEA,2BB3CC94-0F8D-406E-A089-BB05B0771D8F,C0E6D0DF-2B40-46EB-8D78-CAF0409C8068,815F7833-C449-46E2-B461-D0668C63CC20,CAAE357E-CDD0-4F22-8572-D6086CA019E2,D4198BFA-ACDB-468A-ADDB-DEAFF0949B53,107F2679-892C-4688-AF01-E2373D2B6F4B,DCA862E6-00F2-44AE-B8E7-EC6E2F6AFB36,F6ADEF7C-A5E6-4DB6-B85C-ED93B44E823E,78A92ACC-EDDC-44F7-BCBE-F7F86238EC74'
	@id_documents varchar(255) = NULL
AS
BEGIN
	-- SET NOCOUNT ON added to prevent extra result sets from
	-- interfering with SELECT statements.
	SET NOCOUNT ON;

    -- Insert statements for procedure here
    DECLARE @id_document uniqueidentifier
 --   CREATE TABLE tmp_del_dep (id_document uniqueidentifier)
	--INSERT INTO tmp_del_dep
	--EXEC ithaque.dbo.spCalculSplit '7DA68C98-741C-4CAD-ADAB-17F41AA36A37,BC9AAD7F-4211-4D1C-BE04-3D0ABC513DC0,174145D4-3139-4B03-80D6-4399ECFD3AAD,D4F010C2-22AB-4862-AEC5-55A0B55E2239,EC051990-F100-4555-9822-58067E0C9503,3FB0F8BB-8564-48F0-A240-61AB4ACC5789,641A1A47-56FB-4271-A3A9-6B7077487F87,D215EC50-334C-4130-B112-708E8599AA99,9B4D3492-106F-47A8-9218-8A83C5FB22A2,CB732C41-0794-479D-88DF-AFBB639131FD,D630DF1D-EB7B-4C65-A5C4-B172FFE56553,08738B3C-6AEB-4BC1-930B-B2BF74161008,889EB926-5EF5-4D51-8616-B95AE4BCA4BB,E225E6D9-460A-4883-921D-B9D43FD9DDEA,2BB3CC94-0F8D-406E-A089-BB05B0771D8F,C0E6D0DF-2B40-46EB-8D78-CAF0409C8068,815F7833-C449-46E2-B461-D0668C63CC20,CAAE357E-CDD0-4F22-8572-D6086CA019E2,D4198BFA-ACDB-468A-ADDB-DEAFF0949B53,107F2679-892C-4688-AF01-E2373D2B6F4B,DCA862E6-00F2-44AE-B8E7-EC6E2F6AFB36,F6ADEF7C-A5E6-4DB6-B85C-ED93B44E823E,78A92ACC-EDDC-44F7-BCBE-F7F86238EC74'

		
	DECLARE cursor_del_dep cursor for
	SELECT id_document
	FROM saisie_donnees_documents
	WHERE id_document in (SELECT id_document FROM tmp_del_dep)
	OPEN cursor_del_dep
	FETCH cursor_del_dep INTO @id_document
	WHILE @@FETCH_STATUS = 0
	BEGIN
		print @id_document
		EXEC delete_departement_avec_tous_les_info @id_document
		FETCH cursor_del_dep INTO @id_document
	END
	CLOSE cursor_del_dep
	DEALLOCATE cursor_del_dep
	
	
	
	DROP TABLE tmp_del_dep
END
GO
